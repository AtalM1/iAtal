\documentclass[a4paper,11pt]{article}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{listings}


%opening
\title{iAtal Manual}
\author{Agathe \textsc{Moll\'e} \and Gr\'egoire \textsc{Jadi} \and Hugo \textsc{Mougard} \and Joseph \textsc{Lark} 
\and Lo\"\i c \textsc{Jankowiak} \and No\'emi \textsc{Sala\"un} \and R\'emi \textsc{Bois}}
\date{\today}

\begin{document}

\maketitle

\tableofcontents



\section*{Preface}
This manual documents the use of the application iAtal.  As a
reference manual, it will describe the different features of the
application. It includes a tutorial in order to help the
beginners. You will also find an help to compile, install and run the
program.  All the specific terms will be explained in a glossary.
  %TODO : blablabla, skip chapters blabla
  
\section*{Introduction}
The application described here is named iAtal. It's a rover behaviour
simulation platform.  A rover is a robot which executes some tasks in
a self-sufficient way, and in an unknown environment.  It owns sensors
that help it to feel and understand its close environment and
actuators that allow it to move and to interact with the map.


The iAtal program can deal with any map in TMX format. Those maps can
be created with Tiled %TODO ref%
or manually.  You can also create your own exploration strategy, your
rover's sensors and actuators, thanks to Python.  Those features will
be detailed further.

\section{How to run iAtal}

\subsection{Requirements}
% TODO : Attentes de l’application en terme d’architecture machine et
% de logiciels pré-installés

\subsection{Installing iAtal}
% TODO

\subsection{Running iAtal}
% TODO : façons correctes de lancer iAtal...
There are two different ways to run the program :
\begin{itemize}
\item Whithout any option :
\begin{verbatim}
	.\ui
\end{verbatim}
  The program will then start empty and you will have to set the map
  and the rover strategy later. (See chapter...)
  
\item Directly with a personnalised map and/or exploration strategy :
\begin{verbatim}
	.\ui [-h|--help] [{-m|--map} map_path] [{-s|--strategy} strat_path]
\end{verbatim}
  Description of these options :
  \begin{itemize}
  \item \verb!-h! or \verb!--help! : Produce help message
  \item \verb!-m map_path! or \verb!--map map_path! : Set the path to
    the map to use. It must be a file in TMX format (.tmx) (See
    chapter...)
  \item \verb!-s strat_path! or \verb!--strategy strat_path! : Set the
    path to the strategy to use. It must be a file in Python (.py). It
    requires a map to be set too. (See chapter...)
  \end{itemize}
\end{itemize}

\section{Importing a map}

\subsection{Creating a TMX map}

To create your own map, it is strongly recommended to use the software
Tiled (ref, doc).  Tiled generates XML files wich are on the TMX
format, supported by iAtal. However, you should know that iAtal map
loader is limited to maps with 4 layers or less.

Once your map is created, you just have to save it, and to load it in
iAtal.




\section{Defining a robot and a strategy with Python}

This section will describe how to define a robot and a strategy to
apply to the selected map. The user will have to implement some
functions in order to describe how the robot will behave and some of
its features. These functions have to be located in a file which will
be given to the application. The table \ref{tab:PyMandatoryFunc}
presents the mandatory functions to use in the strategy file.

\begin{table}[h]
  \begin{center}
    \begin{tabular}{|c|p{10cm}|}
      \hline
      Name & Purpose \\
      \hline
      robot\_init & Sets the start position, the direction faced by the
      robot and the sprites used to represent it \\
      \hline
      strat & Describes an iteration of the strategy used. Sensors and
      actuators are used here. The robot may move or perform some
      actions in each iteration. \\
      \hline
      isEnded & Function returning True when the strategy is finished
      (the robot completed its job) or False if more iterations are to
      come.\\ 
      \hline 
    \end{tabular}
    \caption{\label{tab:PyMandatoryFunc} The mandatory functions}
  \end{center}
\end{table}

\subsection{Defining a robot with robot\_init}

The robot\_init function sets some informations such as the direction
faced by the robot at start, the position of the robot at start, and
the sprites used to draw the robot. These 3 actions use the global
map\_ variable. These three actions should be performed (or else the
program may be malfunctionning), but some other actions could be
performed such as the description and initialization of the sensors
and actuators of your robot. You could also decide to give some
extra-features to your robot such as a battery-state, this is the
right place to define it, semantically (defining your actuators,
sensors or extra-features somewhere else in the file is still
possible).

We will now see the basic actions that must be performed and some
example of what you can do.

\subsubsection{Where the robot starts}

This action is \emph{mandatory}. You have to specify where your robot
starts on the map. You have to use the following function :

\begin{lstlisting}[language=Python]
map_.setPosition(xPosition, yPosition)
\end{lstlisting}

The xPosition (resp. yPosition) corresponds to the abscissa
(resp. ordinate) where the robot will be placed at start. These
coordinates refer to the TMX map loaded. The (0,0) box is located on
the top-left of the TMX map.

You also have to specify in which direction the robot watches. Only
maps with 4 directions are currently supported. These directions are
defined by these pairs :


\begin{table}[h]
\begin{center}
\begin{tabular}{|c|c|}
  \hline
  Pair & Meaning \\
  \hline
  (1,0) & East \\
  (0,-1) & North \\
  (-1,0) & West \\
  (0,1) & South \\
  \hline
\end{tabular} 
\caption{\label{tab:Pypairs} The avaible pairs to describe a
  direction}
\end{center}
\end{table}


You have to use the following function which is \emph{mandatory} :

\begin{lstlisting}[language=Python]
map_.setPosition(x,y)
\end{lstlisting}

Where (x,y) is one of the pairs presented in the table \ref{tab:Pypairs}.

\subsubsection{What the robot looks like}

In order to represent the robot on the map, you have to give an image
uri which will reprensent it. Since your robot can face 4 different
directions, it is asked to give 4 images, one for each direction the
robot can face. However, you can put 4 times the same picture.

The order for the pictures is north, south, east, west.

You have to use the following function wich is \emph{mandatory} :

\begin{lstlisting}[language=Python]
map_.setRobotImage(northImg, southImg, eastImg, westImg)
\end{lstlisting}

Where northImg (resp. southImg, eastImg, westImg) corresponds to the
image to use when the robot faces north (resp. south, east, west).

\subsubsection{Sensors}

You have to describe the robot's sensors. A sensor is a feature that
gives the possibility to your robot to have information on its
environment. Even if you can instantiate and use a sensor from
everywhere, it is highly recommended to declare it in the robot\_init()
function (or in a subfunction called by robot\_init()).

A sensor can get an information about a tile at a fixed range, and on
a precise layer. You can find the list of the avaible layers in
section REFNEEDED.

For example, it can have access to the tile right in front of the
robot (range 1), and sense the Object layer (enums.Level.Object).

To declare a sensor, you may use the following syntax :

\begin{lstlisting}[language=Python]
  global mySensor
  mySensor = sensor(map_,enums.Level.Object,1)
\end{lstlisting}

\subsubsection{Actuators}


\subsubsection{The compass}


\subsubsection{Extending your robot abilities}


\subsection{Defining a strategy with strat}

\subsubsection{Using the sensors and the actuators}

\subsubsection{Some useful functions}

\subsection{Specifying the end with isEnded}



\end{document}
